cc_library(
    name = "basic_gdal",
    srcs = glob(["impl/*.cpp"]),
    hdrs = glob(["impl/*.h"]),
    linkopts = [],
    visibility = ["//visibility:public"],
    deps = [
        "@vcpkg",
    ],
)

filegroup(
    name = "tif_file",
    srcs = ["WI_Poynette_801263_1901_62500_geo.tif"],
)

# 在 build_config/windows.bzl 或 BUILD 文件中
config_setting(
    name = "windows_dbg",
    values = {"compilation_mode": "dbg"},
)

config_setting(
    name = "windows_opt",
    values = {"compilation_mode": "opt"},
)

cc_binary(
    name = "main",
    srcs = [
        "main.cpp",
    ],
    args = [
        "$(location :tif_file)",
    ],
    data = [
        ":tif_file",
    ],
    linkopts = select({
        "@platforms//os:linux": [
            "-lgdal",
            "-lqhullstatic_r",
            "-lgeotiff",
            "-lLerc",
            "-lzstd",
            "-lpng16",
            "-lgif",
            "-lnetcdf",
            "-lhdf5_hl",
            "-ltinyxml2",
            "-lhdf5",
            "-lsz",
            "-laec",
            "-lwebp",
            "-lsharpyuv",
            "-lopenjp2",
            "-lkmlengine",
            "-lkmldom",
            "-lkmlbase",
            "-luriparser",
            "-lpcre2-8",
            "-lspatialite",
            "-lfreexl",
            "-lminizip",
            "-lpq",
            "-lpgport",
            "-lpgcommon",
            "-lexpat",
            "-lxml2",
            "-lc",
            "-lgeos_c",
            "-lgeos",
            "-lproj",
            "-lsqlite3",
            "-ltiff",
            "-llzma",
            "-ljpeg",
            "-lcurl",
            "-lssl",
            "-lcrypto",
            "-ldl",
            "-lz",
            "-ljson-c",
            "-lstdc++",
            "-lm",
        ],
        "@platforms//os:windows": [
            "gdald.lib",  # 默认使用debug 相关的lib,
        ],
        "//conditions:default": [],
    }),
    deps = [
        ":basic_gdal",
        "@bazel_tools//tools/cpp/runfiles",

        #                "@bazel_tools//tools/cpp/runfiles",  # Standard runfiles library
        #        "@rules_cc//cc/runfiles",  # 假设你已经依赖 rules_cc runfiles
    ],
)
